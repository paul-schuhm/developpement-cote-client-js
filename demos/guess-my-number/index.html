<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Guess my number</title>
    </head>

    <body>
        <h1>Guess my number</h1>

        <section id="current-game">
            <h2>Partie en cours</h2>
            <p>Vous devez trouver le nombre secret compris entre 0 et 100 (exclus) en un maximum de <span
                    id="maxNumberOfGuesses"></span> essais </p>

            <p id="clue"></p>
            <form action="">
                <input type="number" min="0" max="100" id="guess">
                <input type="submit" id="submitGuess" value="Proposer">
            </form>

            <p>Il vous reste <span id="numberOfGuesses"></span> essais</p>
        </section>

        <section id="new-game">
            <h1>Game over</h1>
            <p id="game-over"></p>
        </section>


        <section id="references">
            <h2>Références</h2>
            <ul>
                <li><a href="https://developer.mozilla.org/fr/docs/Learn/JavaScript/First_steps/A_first_splash">Notre
                        premier code JavaScript</a></li>
                <li><a
                        href="https://developer.mozilla.org/fr/docs/Web/API/EventTarget/addEventListener">addEventListener</a>
                </li>
                <li><a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/confirm">window.confirm()</a> :
                    Affiche
                    un dialog (pop-up) avec demande de confirmation</li>
                <li><a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/alert">window.alert()</a> :
                    Afficher un
                    dialog (pop-up) avec un message</li>
                <li><a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/prompt">window.alert()</a> :
                    Afficher
                    un dialog (pop-up) avec un formulaire simple</li>
                <li><a
                        href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input#value">HTMLInputElement.value</a>
                </li>
                <li><a href="https://developer.mozilla.org/fr/docs/Web/API/Node/textContent">element.textContent</a>
                </li>
                <li><a href="https://developer.mozilla.org/fr/docs/Web/API/Element/innerHTML">element.innerHTML</a></li>
                <li><a href="https://developer.mozilla.org/fr/docs/Web/API/Node/textContent">element.textContent</a>
                </li>
                <li><a
                        href="https://developer.mozilla.org/fr/docs/Web/API/Document/createElement">document.createElement</a>
                </li>
                <li><a href="https://developer.mozilla.org/fr/docs/Web/API/Node/removeChild">element.removeChild</a>
                </li>
            </ul>
        </section>

        <script>

            //Références (globales) vers des éléments HTML
            var spanMaxNumberOfGuesses = document.querySelector("#maxNumberOfGuesses");
            var spanNumberOfGuesses = document.querySelector("#numberOfGuesses");
            var btnSubmitGuess = document.querySelector('#submitGuess');
            var inputGuess = document.querySelector('#guess');
            var currentGame = document.querySelector('#current-game');
            var newGame = document.querySelector('#new-game');
            var pClue = document.querySelector('#clue');

            var maxNumberOfGuesses = 5;
            var numberOfGuessesRemaining;


            //Initialisation du jeu
            initGameState();

            //Ajouter un eventListener
            btnSubmitGuess.addEventListener("click", submitGuess)

            /**
             * Initialise l'état du jeu (nombre à trouver, nombre d'essais restants, UI)
             */
            function initGameState() {
                numberOfGuessesRemaining = maxNumberOfGuesses;
                numberToGuess = Math.floor(Math.random() * 100) + 1;

                //Initialiser les éléments HTML
                spanMaxNumberOfGuesses.textContent = maxNumberOfGuesses;
                spanNumberOfGuesses.textContent = numberOfGuessesRemaining
            }

            /**
             * Démarre une nouvelle partie
             */
            function startNewGame() {
                console.log('Start new game')
                //Enlever la section new game
                newGame.remove();
                //Ajouter la section start-new-game
                let ref = document.querySelector('#references')
                document.body.insertBefore(currentGame, ref)
                //Réinitialiser le jeu
                initGameState();
            }

            /**
           * Soumet la tentative
           */
            function submitGuess() {

                console.log(numberToGuess, maxNumberOfGuesses, numberOfGuessesRemaining)

                event.preventDefault(); // Empêche le comportement par défaut du formulaire (Soumettre requete HTTP)

                //Récupérer le nombre
                const guess = parseInt(inputGuess.value);

                numberOfGuessesRemaining--;

                if (guess === numberToGuess) {

                    //Retirer la partie en cours
                    currentGame.remove();
                    //Afficher le gameover avec succes
                    let ref = document.querySelector('#references')
                    document.body.insertBefore(newGame, ref)

                    //Afficher un bouton "Recommencer une partie" s'il n'existe pas.
                    if (!document.querySelector('#start-new-game')) {
                        let btnNewGame = document.createElement('button');
                        btnNewGame.id = "start-new-game";
                        btnNewGame.textContent = "Rejouer une partie";
                        btnNewGame.addEventListener("click", startNewGame)
                        newGame.appendChild(btnNewGame)
                    }

                    let pMessage = document.querySelector('#game-over');
                    let nbOfGuesses = maxNumberOfGuesses - numberOfGuessesRemaining
                    pMessage.textContent = "Gagné, le nombre à trouver était bien " + numberToGuess + ". Vous avez trouvé en " + nbOfGuesses + " coups ! Bravo !";

                } else {
                    spanNumberOfGuesses.textContent = numberOfGuessesRemaining;
                    //Donner un indice (plus grand ou plus petit)
                    let clue = numberToGuess > guess ? "Plus grand !" : "Plus petit !";
                    pClue.textContent = clue;
                }

                const isGameLost = numberOfGuessesRemaining === 0;

                if (isGameLost) {

                    //Retirer le current game
                    currentGame.remove();

                    //Afficher le gameover avec succes
                    let ref = document.querySelector('#references')
                    document.body.insertBefore(newGame, ref)

                    //Afficher un bouton "Recommencer une partie" s'il n'existe pas.
                    if (!document.querySelector('#start-new-game')) {
                        let btnNewGame = document.createElement('button');
                        btnNewGame.id = "start-new-game";
                        btnNewGame.textContent = "Rejouer une partie";
                        btnNewGame.addEventListener("click", startNewGame)
                        newGame.appendChild(btnNewGame)
                    }

                    //Afficher un message "Vous avez perdu"
                    let pMessage = document.querySelector('#game-over');
                    pMessage.textContent = "Perdu !";

                }

            }
        </script>
    </body>

</html>